# SpringBoot with MongoDB
## SprinBoot
- version : 2.7.5
- dependencies
    - spring-boot-starter-web
    - spring-boot-starter-security
    - spring-boot-starter-oauth2-resource-server
    - spring-boot-starter-validation
    - spring-boot-starter-data-mongodb
    - springdoc-openapi-ui
    - springdoc-openapi-security

### JWT Authentication
In this repo, JWT is generated by the resource server, which means it also authorizes JWT everytime while receiving the request to meet the **STATELESS** state, you can find the [JwtTokenFilter](https://github.com/chentihe/springboot-mongodb/blob/main/src/main/java/tihe/chen/springbootmongodb/filters/JwtTokenFilter.java) to see the authentication process.

The JWT generator uses Nimbus library along with RSA key pair, check [Security Configuration](https://github.com/chentihe/springboot-mongodb/blob/main/src/main/java/tihe/chen/springbootmongodb/configs/SecurityConfiguration.java) for details.

This repo doesn't provide user-related APIs, only creates a mock admin user which is stored in memory for test use.

### CORS
GET methods are accessible without authorization since the request will be dispatched only from allowed origins.
Using @CrossOrigin annotation on controller to make CORS more flexible.

### Environment Setup

This project is built by docker, the program environment parameter is passed by docker command line.
There are two environments: development and production, therefore, it needs two `application-<env>.yml` file for the given environment to switch different properties.
The environment arguments are set in [pom.xml](https://github.com/chentihe/springboot-mongodb/blob/main/pom.xml).

## MongoDB
This app connects with MongoDB cloud database. [Sign-up](https://www.mongodb.com/) an account to try free package.

MongoTemplate has many out-of-the-box wrapped functions to implement basic CRUD operations, hence, this repo uses MongoTemplate to interact with MongoDB.

Replace the correct MongoDB Connection URI on `application-<env>.yml`.

## Docker
It's easy to build a SpringBoot app with Docker.
```sh
docker build --tag <your-app-name>:<version> .
```
By default, the env of the program is dev, but it can be changed by passing env args while running the docker container
```sh
docker run -p8080:8080 -e PROJECTENV=<env> <your-app-name>
```

Open the browser and navigate to the Swagger page.
```sh
http://localhost:8080/swagger-ui.html
```

## Deploy to Cloud Run
The GitHub action are setup, All you need to do is to fill-in the necessary arguments for the cloud run.
Since this project has two environment, if you want to mimic the real developing procedure, feel free to create a dev branch and test it first by deploying the development environment. After all APIs are tested, merging dev branch to main branch and pushing to remote repo to trigger the GitHub action which will deploy to the production environment.
